<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Roll For Your Party</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.2.9/interact.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fingerprintjs2/1.5.1/fingerprint2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/darktooltip/0.4.0/jquery.darktooltip.min.js"></script>
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/darktooltip/0.4.0/darktooltip.css">
    <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <!--<link rel="stylesheet" href="/js/jquery.postitall.css">-->
    <!--<script src="/js/jquery.postitall.js"></script>-->

    <script type="text/javascript" language="javascript">

        var fp = "";
        new Fingerprint2().get(function (result, components) {
            fp = result; //a hash, representing your device fingerprint
            var x = document.getElementsByName("fp");
            x[0].value = fp;
        });

        // target elements with the "draggable" class
        interact('.draggable')
            .draggable({
                // enable inertial throwing
                inertia: true,
                // enable autoScroll
                autoScroll: true,

                onstart: function (event) {
                    // update the posiion attributes
                    event.target.setAttribute('start-x', event.x0);
                    event.target.setAttribute('start-y', event.y0);
                },
                // call this function on every dragmove event
                onmove: dragMoveListener,
                onend: dragMoveEnd,
                // call this function on every dragend event
            });


        function dragMoveEnd(event) {
            var target = event.target,
                // keep the dragged position in the data-x/data-y attributes
                x = (parseFloat(target.getAttribute('data-x')) || 0),
                y = (parseFloat(target.getAttribute('data-y')) || 0);


            // TODO(shanel): This is janky and annoying...
            var transformer = target.style.transform;
            if (transformer.search("px") !== -1) {
                x += parseFloat(target.getAttribute('start-x'));
                y += parseFloat(target.getAttribute('start-y'));
            }


            // translate the element
            target.removeAttribute("style");
            target.style.position = 'absolute';
            target.style.top = y + 'px';
            target.style.left = x + 'px';

            // update the position attributes
            target.setAttribute('data-x', x);
            target.setAttribute('data-y', y);

            $.post('/move', {
                'id': target.id,
                'x': x,
                'y': y,
                'fp': fp
            });

        }

        var delete_cookie = function (name) {
            document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/';
            document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/room';
        };

        var getNewRoom = function () {
            delete_cookie("dice_room");
            window.location.replace("/");
        };


        function dragMoveListener(event) {
            var target = event.target,
                // keep the dragged position in the data-x/data-y attributes
                x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
                y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;


            // translate the element
            var transformer = target.style.transform;
            if (transformer.search("px") !== -1) {
                target.style.mstransform =
                    target.style.webkittransform =
                        target.style.transform =
                            'translate(' + x + 'px, ' + y + 'px)';
            } else {
                target.style = null;
                target.style.position = 'absolute';
                target.style.top = y + 'px';
                target.style.left = x + 'px';
            }


            // update the posiion attributes
            target.setAttribute('data-x', x);
            target.setAttribute('data-y', y);
        }


        // this is used later in the resizing and gesture demos
        window.dragMoveListener = dragMoveListener;

        function deleteMarked() {
            var toDelete = document.getElementsByClassName("selected");
            for (var i = 0; i < toDelete.length; i++) {
                $.post("/delete", {
                    id: toDelete[i].id,
                    'fp': fp
                }).done(function (data) {
                });
            }
            if (toDelete.length > 0) {
                $("#refreshable").load(window.location.href + " #refreshable");
            }
            $("#refreshable").load(window.location.href + " #refreshable");
        }

        function rerollMarked() {
            var toReroll = document.getElementsByClassName("selected");
            for (var i = 0; i < toReroll.length; i++) {
                $.post("/reroll", {
                    id: toReroll[i].id,
                    'fp': fp
                }).done(function (data) {
                });
            }
            if (toReroll.length > 0) {
                $("#customButtons").load(window.location.href + " #customButtons");
                $("#refreshable").load(window.location.href + " #refreshable");
            }
            $("#customButtons").load(window.location.href + " #customButtons");
            $("#refreshable").load(window.location.href + " #refreshable");
        }

        function clearAllDice() {
            var clear = confirm("Clear all dice from room?");
            if (clear == true) {
                $.post("/clear", {
                    'fp': fp
                }).done(function (data) {
                });
            }
            $("#refreshable").load(window.location.href + " #refreshable");
            $("#refreshable").load(window.location.href + " #refreshable");
            $("#refreshable").load(window.location.href + " #refreshable");
        }

        function shuffleDiscards() {
            $.post("/shuffle", {
                'fp': fp
            }).done(function (data) {
            });
            $("#refreshable").load(window.location.href + " #refreshable");
        }

        {{range.CustomSets}}
        function {{.Pull}} {
            var count = prompt("How many items would you like to pull from {{.Name}}?")
            if (count == null) {
                count = "1";
            }
            $.post("/draw", {
                fp: fp,
                deck: {{.Name}},
                count: count
        }).done(function (data) {});
        $("#customButtons").load(window.location.href + " #customButtons");
        $("#refreshable").load(window.location.href + " #refreshable");
        }


        function {{.Randomize}} {
            $.post("/shuffle", {
                fp: fp,
                deck: {{.Name}}
        }).done(function (data) {});
            $("#customButtons").load(window.location.href + " #customButtons");
            $("#refreshable").load(window.location.href + " #refreshable");
        }
        {{end}}

        function xCard() {
            var message = prompt("If you would like to be specific about the content requiring your use of this safety tool, you may do so here. If not, you may leave it blank.");
            if (message !== null) {
                if (message !== "") {
                    message = "Someone Played The X-Card: " + message;
                } else {
                    message = "Someone Played The X-Card";
                }
                $.post("/alert", {
                    'message': message
                }).done(function (data) {
                });
                $("#refreshable").load(window.location.href + " #refreshable");
            }
        }

        function rewind() {
            var message = prompt("If you would like to be specific about the content requiring your use of this safety tool, you may do so here. If not, you may leave it blank.");
            if (message !== null) {
                if (message !== "") {
                    message = "Someone Called For A Script Change - Rewind: " + message;
                } else {
                    message = "Someone Called For A Script Change: Rewind";
                }
                $.post("/alert", {
                    'message': message
                }).done(function (data) {
                });
                $("#refreshable").load(window.location.href + " #refreshable");
            }
        }

        function pause() {
            var message = prompt("If you would like to be specific about the content requiring your use of this safety tool, you may do so here. If not, you may leave it blank.");
            if (message !== null) {
                if (message !== "") {
                    message = "Someone Called For A Script Change - Pause: " + message;
                } else {
                    message = "Someone Called For A Script Change: Pause";
                }
                $.post("/alert", {
                    'message': message
                }).done(function (data) {
                });
                $("#refreshable").load(window.location.href + " #refreshable");
            }
        }

        function fastForward() {
            var message = prompt("If you would like to be specific about the content requiring your use of this safety tool, you may do so here. If not, you may leave it blank.");
            if (message !== null) {
                if (message !== "") {
                    message = "Someone Called For A Script Change - Fast-Forward: " + message;
                } else {
                    message = "Someone Called For A Script Change: Fast-Forward";
                }
                $.post("/alert", {
                    'message': message
                }).done(function (data) {
                });
                $("#refreshable").load(window.location.href + " #refreshable");
            }
        }

        function fixedEncodeURIComponent(str) {
            return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {
                return '%' + c.charCodeAt(0).toString(16);
            });
        }

        function setBackground() {
            var url = prompt("Please enter the URL to the image you would like used as the background for the room. (To remove the current background leave this blank and submit.)");
            if (url !== null) {
                $.post("/background", {
                    'bg': url
                }).done(function (data) {
                });
                location.reload();
            }
        }

        interact('.tap-target')
            .on('doubletap', function (event) {
                event.currentTarget.classList.toggle('selected');
                rerollMarked();
                $("#refreshable").load(window.location.href + " #refreshable");
            })
            .on('tap', function (event) {
                event.currentTarget.classList.toggle('selected');
            });

        var lastRealUpdate = 0;

        function autoRefresh_div() {
            var room = (window.location.pathname).split("/")[2];
            $.post("/refresh", {
                id: room,
                fp: fp
            })
                .done(function (data) {
                    var b = data;
                    var unix = Math.round(+new Date() / 1000);
                    if (b !== "") {
                        var chunks = b.split("||");
                        if (chunks.length == 2) {
                            alert(chunks[1]);
                        }
                        if (sessionStorage.lastUpdateId) {
                            if (b !== sessionStorage.lastUpdateId) {
                                $("#refreshable").load(window.location.href + " #refreshable");
                                sessionStorage.lastUpdateId = b;
                                lastRealUpdate = unix;
                            }
                        } else {
                            $("#refreshable").load(window.location.href + " #refreshable");
                            sessionStorage.lastUpdateId = b;
                            lastRealUpdate = unix;
                        }
                    } else {
                        if (lastRealUpdate > 0) {
                            var delta = unix - lastRealUpdate;
                            // Stop updating after 60m
                            if (delta > 3600) {
                                window.location.replace("/paused?id=" + room);
                            }
                        }
                    }
                });
        }

        setInterval('autoRefresh_div()', 1000); // refresh div after 1 second

        // I don't love this code, but it gets the job done I guess.
        $(function () {
            var dialog, form,

                name = $("#name"),
                entry = $("#lines"),
                height = $("#height"),
                width = $("#width");

            function addEntry() {
                $.post("/addcustomset", {
                    'name': name.val(),
                    'entries': entry.val(),
                    'height': height.val(),
                    'width': width.val()
                }).done(function (data) {
                });
                dialog.dialog("close");
                $("#customButtons").load(window.location.href + " #customButtons");
                return true;
            }

            dialog = $("#dialog-form").dialog({
                autoOpen: false,
                height: 400,
                width: 350,
                modal: true,
                buttons: {
                    "Create a set": addEntry,
                    Cancel: function () {
                        dialog.dialog("close");
                    }
                },
                close: function () {
                    form[0].reset();
                }
            });

            form = dialog.find("form").on("submit", function (event) {
                event.preventDefault();
                addEntry();
            });

            $("#addCustomSetButton").button().on("click", function () {
                dialog.dialog("open");
            });
        });
    </script>


</head>

<!--TODO(shanel): This should probably be in its own file eventually.-->
<style type="text/css">

    .s-noselect {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    #s-rectBox {
        position: absolute;
        z-index: 1090;
        border: 2px dashed #cbd3e3;
    }

    body {
        color: #000000;
        background-color: #ffffff;
    }

    .tap-target {
        display: inline-block;
    }

    .tap-target.selected {
        background-color: #f40;
        border-style: solid;
        border-color: red;
    }

    html {
        height: 100%;
        box-sizing: border-box;
    }

    *,
    *:before,
    *:after {
        box-sizing: inherit;
    }

    body {
        /*position: relative;*/
        margin: 0;
        padding-bottom: 6rem;
        min-height: 100%;
        font-family: "Helvetica Neue", Arial, sans-serif;
    }

    .footer {
        position: fixed;
        right: 0;
        bottom: 0;
        left: 0;
        padding: 1rem;
        background-color: #efefef;
        text-align: center;
    }

    .attribution {
        font-size: x-small;
    }

    .ui-button {
        background-color: #e7e7e7;
        color: black;
        padding: 5px 5px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 8px;
    }

    .ui-button,
    .ui-button:link,
    .ui-button:visited,
    .ui-button:hover,
    .ui-button:active {
    }

    button {
        background-color: #e7e7e7;
        color: black;
        padding: 5px 5px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 8px;
    }

    .button2 {
        background-color: #f44336;
        color: white;
        text-align: center;
    }

    .button3 {
        background-color: black;
        color: #f44336;
        text-align: center;
    }

    /* Tooltip container */
    .tooltip {
        position: relative;
        display: inline-block;
        border-bottom: 1px dotted black; /* If you want dots under the hoverable text */
    }

    /* Tooltip text */
    .tooltip .tooltiptext {
        visibility: hidden;
        width: 120px;
        background-color: white;
        color: blue;
        text-align: center;
        padding: 5px 0;
        border-radius: 6px;

        /* Position the tooltip text - see examples below! */
        position: absolute;
        z-index: 1;
    }

    /* Show the tooltip text when you mouse over the tooltip container */
    .tooltip:hover .tooltiptext {
        -webkit-transition-delay: 1s; /* Safari */
        transition-delay: 1s;
        visibility: visible;
    }

    p {
        text-align: center;
    }

    h3 {
        text-align: center;
    }

    form {
        text-align: center;
    }

    .buttons {
        text-align: center;
    }

    .about {
        text-align: center;
    }

    img.centered {
        display: block;
        margin: 0 auto;
    }

    .refreshable {
        text-align: center;
    }

    img.card {
        display: block;
        max-width: 120px;
        max-height: 120px;
        background-color: white;
        width: auto;
        height: auto;
        border: 2px solid black;
    }

    {{range .CustomSets}}
    img.{{.Name}} {
        display: block;
        max-width: {{.Width}}px;
        max-height: {{.Height}}px;
        /*background-color: white;*/
        width: auto;
        height: auto;
        /*border: 2px solid black;*/
    }

    {{end}}

    /*TODO(shanel): Store this style stuff in the element's actual style tag.*/
    .label {
        /*width: 25%;*/
        /*height: 100%;*/
        /*min-height: 6.5em;*/
        /*margin: 10%;*/

        /*background-color: #29e;*/
        /*color: white;*/

        /*border-radius: 0.75em;*/
        /*padding: 4%;*/

        /*-webkit-transform: translate(0px, 0px);*/
        /*transform: translate(0px, 0px);*/
    }

</style>

<body>

<!--<a href="https://github.com/shanel/roller" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style> -->
<a href="https://github.com/shanel/roller" class="github-corner" aria-label="View source on Github">
    <svg width="80" height="80" viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm {
    animation: octocat-wave 560ms ease-in-out
}

@keyframes octocat-wave {
    0%, 100% {
        transform: rotate(0)
    }
    20%, 60% {
        transform: rotate(-25deg)
    }
    40%, 80% {
        transform: rotate(10deg)
    }
}

@media (max-width: 500px) {
    .github-corner:hover .octo-arm {
        animation: none
    }

    .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
    }
}</style>

<div id="dialog-form" title="Create new entry" style="display: none">

    <form id="myForm">
        <fieldset>
            <label for="name">Name:</label>
            <input type="text" name="name" id="name" value="Single Word Set Name"
                   class="text ui-widget-content ui-corner-all"><br>
            <label for="height">Max Height (in pixels):</label>
            <input type="text" name="height" id="height" value="120" size="3"
                   class="text ui-widget-content ui-corner-all"><br>
            <label for="height">Max Width (in pixels):</label>
            <input type="text" name="width" id="width" value="120" size="3"
                   class="text ui-widget-content ui-corner-all"><br>
            <!-- Allow form submission with keyboard without duplicating the dialog button -->
            <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
        </fieldset>
    </form>
    <textarea name="lines" id="lines" form="myForm" class="textarea ui-widget-content ui-corner-all">Enter one image url per line...</textarea>
</div>

<h3>Roll For Your Party: A multi-user dice roller.</h3>
<p>Send the URL to your friends! (They can watch what you do!) Drag the dice around! Click on dice to select/unselect
    them! Double click them to reroll them!</p>
<form id="rollem" action="/roll" method="post">
    <input type="text" name="d4" id="d4" style="width: 19px"/>
    <label for="d4">d4</label>
    <input type="text" name="d6" id="d6" style="width: 19px"/>
    <label for="d6">d6</label>
    <input type="text" name="d6p" id="d6p" style="width: 19px"/>
    <label id="pipped" for="d6p">d6(P)</label>
    <input type="text" name="d8" id="d8" style="width: 19px"/>
    <label for="d8">d8</label>
    <input type="text" name="d10" id="d10" style="width: 19px"/>
    <label for="d10">d10</label>
    <input type="text" name="d12" id="d12" style="width: 19px"/>
    <label for="d12">d12</label>
    <input type="text" name="d20" id="d20" style="width: 19px"/>
    <label for="d20">d20</label>
    <input type="text" name="dF" id="dF" style="width: 19px"/>
    <label id="fateLabel" for="dF">dF</label>
    <label id="tokenLabel" for="tokens">tokens: </label>
    <input type="text" name="tokens" id="tokens" style="width: 19px"/>
    <label id="cardLabel" for="cards">cards: </label>
    <input type="text" name="cards" id="cards" style="width: 19px"/>
    <label id="labelLabel" for="label">label: </label>
    <input type="text" name="label" id="label" style="width: 100"/>

    <label id="colorLabel" for="selectColor">color: </label>
    <select id="selectColor" name="color">
        <option value="clear" style="color: #ffffff">Clear</option>
        <option value="blue" style="color: #1e90ff">Blue</option>
        <option value="green" style="color: #008b45">Green</option>
        <option value="orange" style="color: #ff8c00">Orange</option>
        <option value="red" style="color: #ff3333">Red</option>
        <option value="violet" style="color: #8a2be2">Purple</option>
        <option value="gold" style="color: #ffd700">Yellow</option>
    </select>

    <input type="hidden" name="fp" value="">
    <p></p>
</form>
<div class="buttons">
    <button class="button button2" form="rollem" formaction="/roll" formmethod="post">Submit</button>
    <button id="clearButton" class="button" onclick="clearAllDice()">Clear</button>
    <button id="deleteButton" class="button" onclick="deleteMarked()">Delete selected</button>
    <button id="rerollButton" class="button" onclick="rerollMarked()">Reroll selected</button>
    <button id="shuffleButton" class="button" onclick="shuffleDiscards()">Shuffle discards</button>
    <button id="backgroundButton" class="button" onclick="setBackground()">Set background</button>
    <button id="newRoomButton" class="button" onclick="getNewRoom()">New room</button>
</div>
<div id="customButtons" class="buttons">
    <button id="addCustomSetButton" class="button">Add custom set</button>
    {{range .CustomSets}}
    <button id="pull_from_{{.SnakeName}}_button" class="button" onclick={{.Pull}}>Pull from {{.Name}} ({{.Remaining}})
    </button>
    <button id="randomize_discards_from_{{.SnakeName}}_button" class="button" onclick={{.Randomize}}>Randomize discards
        from {{.Name}}
    </button>
    {{end}}
</div>
<div class="buttons">
    <span id="safetyLabel">Safety Tools:</span>
    <button id="xCardButton" class="button button3" onclick="xCard()">X-CARD</button>
    <button id="rewindButton" class="button button3" onclick="rewind()">Rewind</button>
    <button id="pauseButton" class="button button3" onclick="pause()">Pause</button>
    <button id="fastForwardButton" class="button button3" onclick="fastForward()">Fast-Forward</button>
</div>
<script>
    // Dark tool tips
    // TODO(shanel): Add tooltips for custom sets.
    $("#clearButton").darkTooltip({
        gravity: 'south',
        content: 'Use this to remove everything from the room.',
        hoverDelay: 1000
    });
    $("#deleteButton").darkTooltip({
        gravity: 'south',
        content: 'Use this to delete a previously clicked (and thus highlighted in red) item.',
        hoverDelay: 1000
    });
    $("#rerollButton").darkTooltip({
        gravity: 'south',
        content: 'Use this to reroll/redraw a previously clicked (and thus highlighted in red) item in place. (You can also double-click items to reroll them.)',
        hoverDelay: 1000
    });
    $("#shuffleButton").darkTooltip({
        gravity: 'south',
        content: 'Use this to shuffle previously cleared/deleted cards back into the deck.',
        hoverDelay: 1000
    });
    $("#backgroundButton").darkTooltip({
        gravity: 'south',
        content: 'Use this to set a background image for the room.',
        hoverDelay: 1000
    });
    $("#newRoomButton").darkTooltip({
        gravity: 'south',
        content: 'Use this to leave this room for a newly created one.',
        hoverDelay: 1000
    });
    $("#pipped").darkTooltip({
        gravity: 'south',
        content: 'd6 with pips',
        hoverDelay: 1000
    });
    $("#fateLabel").darkTooltip({
        gravity: 'south',
        content: 'Fate/Fudge dice',
        hoverDelay: 1000
    });
    $("#tokenLabel").darkTooltip({
        gravity: 'south',
        content: 'colored blank tokens',
        hoverDelay: 1000
    });
    $("#labelLabel").darkTooltip({
        gravity: 'south',
        content: 'movable pieces of text',
        hoverDelay: 1000
    });
    $("#colorLabel").darkTooltip({
        gravity: 'south',
        content: 'choose the color of the dice/tokens you are about to generate',
        hoverDelay: 1000
    });
    $("#safetyButton").darkTooltip({
        gravity: 'north',
        theme: 'light',
        content: '<a target="_blank" href="http://tinyurl.com/x-card-rpg">What\'s the X-Card?</a><br><br><a\n' +
        '            target="_blank" href="http://tinyurl.com/nphed7m">What\'s Script Change? (Rewind/Pause/Fast-Forward)</a>',
        hoverDelay: 1000
    });
    $("#cardButton").darkTooltip({
        gravity: 'south',
        content: 'face up playing cards (no jokers) - use "Shuffle discards" button to refill deck',
        hoverDelay: 1000
    });
    $("#xCardButton").darkTooltip({
        gravity: 'north',
        content: 'Immediately announce to everyone that you need to <a target="_blank" href="http://tinyurl.com/x-card-rpg">X-Card</a> content (anonymously)',
        hoverDelay: 1000
    });
    $("#rewindButton").darkTooltip({
        gravity: 'north',
        content: 'Immediately announce to everyone that you need to call for a <a target="_blank" href="http://tinyurl.com/nphed7m">Script Change</a> Rewind (anonymously)',
        hoverDelay: 1000
    });
    $("#pauseButton").darkTooltip({
        gravity: 'north',
        content: 'Immediately announce to everyone that you need to call for a <a target="_blank" href="http://tinyurl.com/nphed7m">Script Change</a> Pause (anonymously)',
        hoverDelay: 1000
    });
    $("#fastForwardButton").darkTooltip({
        gravity: 'north',
        content: 'Immediately announce to everyone that you need to call for a <a target="_blank" href="http://tinyurl.com/nphed7m">Script Change</a> Fast Forward (anonymously)',
        hoverDelay: 1000
    });
    $("#addCustomSetButton").darkTooltip({
        gravity: 'east',
        content: 'Add custom deck or pool of tokens. You\'ll enter a single-word name, and urls to the images of the items (one to a line). You\'ll also put in max sizes for the images, the default 120 is fine. After creating it you\'ll see two buttons appear beside this. One is to draw a single item (and the button will also tell you how many are left) and the other is to randomize/shuffle discards into the pool/deck, just like the normal playing cards. You can add as many sets as you like. Using the same name will overwrite the previous set.',
        hoverDelay: 1000
    });
</script>
<br>
<div class="about"><a href="/about">about</a></div>
<hr>
<div class="refreshable" id="refreshable">

    {{if .HasBgURL}}
    <style type="text/css">
        .imagine {
            text-align: center;
            min-height: 2000px;
            background-image: url("{{.BgURL}}");
            background-position: center 5%;
            background-repeat: no-repeat;
        }
    </style>
    {{end}}
    <p>Last Roll Total: {{.RollTotal}} Room Total: {{.RoomTotal}} Playing Cards Left: {{.CardsLeft}}</p>
    <div class="imagine" id="imagine">
        {{range .Dice}}
        {{if .New}}
        {{if .IsLabel}}
        <!--TODO(shanel): Have full style here, not just the move stuff.-->
        <div id="{{.KeyStr}}" class="draggable tap-target label" data-x="{{.X}}" data-y="{{.Y}}"
             style="transform: translate({{.X}}px, {{.Y}}px);">
            <p>
            <h3>{{.ResultStr}}</h3></p>
        </div>
        {{else}}
        <div id="{{.KeyStr}}" class="draggable tap-target" data-x="{{.X}}" data-y="{{.Y}}"
             style="transform: translate({{.X}}px, {{.Y}}px);">
            {{if .IsCustomItem}}
            <img class="{{.CustomSetName}}" src="{{.Image}}" alt="{{.Size}}: {{.ResultStr}}">
            {{else if .IsCard}}
            <img class="card" src="{{.Image}}" alt="{{.Size}}: {{.ResultStr}}">
            {{else}}
            <img src="{{.Image}}" alt="d{{.Size}}: {{.ResultStr}}">
            {{end}}
        </div>
        {{end}}
        {{else}}
        {{if .IsLabel}}
        <div id="{{.KeyStr}}" class="draggable tap-target" data-x="{{.X}}" data-y="{{.Y}}"
             style="position: absolute; left: {{.X}}px; top: {{.Y}}px;">
            <p>
            <h3>{{.ResultStr}}</h3></p>
        </div>
        {{else}}
        <div id="{{.KeyStr}}" class="draggable tap-target" data-x="{{.X}}" data-y="{{.Y}}"
             style="position: absolute; left: {{.X}}px; top: {{.Y}}px;">
            {{if .IsCustomItem}}
            <img class="{{.CustomSetName}}" src="{{.Image}}" alt="{{.Size}}: {{.ResultStr}}">
            {{else if .IsCard}}
            <img class="card" src="{{.Image}}" alt="{{.Size}}: {{.ResultStr}}">
            {{else}}
            <img src="{{.Image}}" alt="d{{.Size}}: {{.ResultStr}}">
            {{end}}
        </div>
        {{end}}
        {{end}}
        {{end}}
    </div>
</div>

<div class="footer">
    If you get use out of this site, please consider donating to <a href="http://www.shantibhavanchildren.org/">Shanti
    Bhavan</a>.
    <br>
    <div class="attribution">
        Design and functionality based on <a href="https://www.thievesoftime.com/">Graham Walmsley</a>'s <a
            href="//https://catchyourhare.com/diceroller/">dice roller</a>.
    </div>
</div>

</body>

</html>